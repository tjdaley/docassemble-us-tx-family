---
metadata:
  title: |
    Add New Case
  short title: |
    Add New Case
  description: |
    Interview to create a new case.
  authors:
    - name: Thomas J. Daley, J.D.
      organization: attorney.bot
  revision_date: 2020-02-01
---
features:
  centered: False
  progress bar: True
---
modules:
  - docassemble.us_tx_family.functions
  - docassemble.us_tx_family.objects
  - docassemble.base.logger
---
objects:
  - case: Case
---
include:
  - basic-questions.yml
  - docassemble.us_tx_family:attorney.yml
  - docassemble.us_tx_family:terms.yml
  - docassemble.us_tx_family:all_docs.yml
---
mandatory: True
code: |
  initialize_case(case)
---
mandatory: True
code: |
  # Gather remaining attorneys
  case.attorney.gather()
---
mandatory: True
code: |
  # Now Populate the basic case information
  case.petitioner.gather(minimum=1)
  case.respondent.gather(minimum=1)
  case.intervenor.gather()
  case.children.gather()
---
mandatory: True
code: |
  # Associate an attorney for each party
  for p in case.petitioner:
    if p.attorney.bar_number == '':
      p.attorney.email
  for p in case.respondent:
    if p.attorney.bar_number == '':
      p.attorney.email
  for p in case.intervenor:
    if p.attorney.bar_number == '':
      p.attorney.email
---
mandatory: True
code: |
  # Make a list of all the parties we represent
  case.client.clear()
  for p in case.petitioner:
    if p.attorney.bar_number == case.me.bar_number:
      case.client.append(p, set_instance_name=True)
      case.client_role = "Petitioner"
  for p in case.respondent:
    if p.attorney.bar_number == case.me.bar_number:
      case.client.append(p, set_instance_name=True)
      case.client_role = "Respondent"
  for p in case.intervenor:
    if p.attorney.bar_number == case.me.bar_number:
      case.client.append(p, set_instance_name=True)
      case.client_role = "Intervenor"
  case.client.gathered = True
  case.client.is_there_another = False
  save_case(case)
---
generic object: RepresentedParty
section: case
decoration: balance-scale
sets: x.attorney.email
question: |
  Who represents ${x}?
fields:
  - Attorney: x.attorney
    datatype: object
    choices:  case.attorney
---
generic object: ChildList
question: Information about the ${ordinal(i)} child.
fields:
  - First name: x[i].name.first
  - Middle name: x[i].name.middle
    required: False
  - Last name: x[i].name.last
  - Suffix: x[i].name.suffix
    required: False
    code: |
      name_suffix()
  - Sex: x[i].sex
    choices:
    - F: Female
    - M: Male
  - Birth date: x[i].birthdate
    datatype: date
  - Home state: x[i].home_state
    default: TX
    code: |
      us_states()
    
---
section: case
decoration: balance-scale
question: |
  What county has your case been filed in?
mandatory: False
fields:
  - County: case.county
    code: |
      counties()
    help: This is the county within ${case.state} where your case was filed.
---
section: case
decoration: balance-scale
question: |
  Tell me a little more about your case.
sets: court.court_id
fields:
  - Court number: case.court.court_id
    code: |
      courts(case.county)
  - Cause number: case.case_id
  - Footer text: case.footer
    help: This text summarizes the case style and appears in footers, e.g. "IMMO DALEY AND DALEY"
---
section: case
decoration: balance-scale
question: |
  Divorce or Anulment?
subquestion: |
  Is this form being used in a marriage dissolution case (divorce or anulment)?
yesno: case.is_divorce
---
mandatory: True
decoration: check-double
question: |
  Review the People in Your Case
subquestion: |
  ** ${title_case(case.attorney.as_noun())} **
  
  ${case.attorney}
  
  [Edit](${url_action('review_attorneys')})
  
  ** ${title_case(case.petitioner.as_noun())} **
  
  ${case.petitioner}
  
  [Edit](${url_action('review_petitioners')})
  
  ** ${title_case(case.respondent.as_noun())} **
  
  ${case.respondent}
  
  [Edit](${url_action('review_respondents')})
  
  ** ${title_case(case.intervenor.as_noun())} **
  
  ${case.intervenor}
  
  [Edit](${url_action('review_intervenors')})
  
  ** ${title_case(case.child.as_noun())} **
  
  ${case.child}
  
  [Edit](${url_action('review_children')})
field: case_people_reviewed
---
event: review_attorneys
decoration: check-double
question: Review Attorney List
review:
  - Edit: case.attorney.revisit
    button: |
      ${case.attorney.as_noun()}:
      
      % for atty in case.attorney:
      * ${atty}
      % endfor
---
event: review_petitioners
decoration: check-double
question: Review Petitioner List
review:
  - Edit: case.petitioner.revisit
    button: |
      ${case.petitioner.as_noun()}:
      
      % for p in case.petitioner:
      * ${p}
      % endfor
---
event: review_respondents
decoration: check-double
question: Review Respondent List
review:
  - Edit: case.respondent.revisit
    button: |
      ${case.respondent.as_noun()}:
      
      % for p in case.respondent:
      * ${p}
      % endfor
---
event: review_intervenors
decoration: check-double
question: Review Intervenor List
review:
  - Edit: case.intervenor.revisit
    button: |
      ${case.intervenor.as_noun()}:
      
      % for p in case.intervenor:
      * ${p}
      % endfor
---
event: review_children
decoration: check-double
question: Review Children
review:
  - Edit: case.child.revisit
    button: |
      ${case.child.as_noun()}:
      
      % for p in case.child:
      * ${p}
      % endfor
---
field: case.attorney.revisit
decoration: check-double
question: Edit Attorney List
subquestion: |
  ${case.attorney.table}
  
  ${case.attorney.add_action()}
---
table: case.attorney.table
decoration: check-double
rows: case.attorney
columns:
  - Name: row_item.name.full()
edit:
  - bar_number
---
field: case.petitioner.revisit
decoration: check-double
question: Edit Petitioner List
subquestion: |
  ${case.petitioner.table}
  
  ${case.petitioner.add_action()}
---
table: case.petitioner.table
decoration: check-double
rows: case.petitioner
columns:
  - Name: row_item.name.full()
edit:
  - name.first
---
field: case.respondent.revisit
decoration: check-double
question: Edit Respondent List
subquestion: |
  ${case.respondent.table}
  
  ${case.respondent.add_action()}
---
table: case.respondent.table
decoration: check-double
rows: case.respondent
columns:
  - Name: row_item.name.full()
edit:
  - name.first
---
field: case.intervenor.revisit
decoration: check-double
question: Edit Intervenor List
subquestion: |
  ${case.intervenor.table}
  
  ${case.intervenor.add_action()}
---
table: case.intervenor.table
decoration: check-double
rows: case.intervenor
columns:
  - Name: row_item.name.full()
edit:
  - name.first
---
field: case.child.revisit
decoration: check-double
question: Edit Child List
subquestion: |
  ${case.child.table}
  
  ${case.child.add_action()}
---
table: case.child.table
decoration: check-double
rows: case.child
columns:
  - Name: row_item.name.full()
edit:
  - name.first
---
mandatory: True
decoration: check-double
question: |
  Review the Details of Your Case
subquestion: |
  
  &nbsp; | &nbsp; | &nbsp;
  -----|-----|-----
  **County** | ${case.county} | [Edit](${url_action('review_county')})
  **Court** | ${case.court.court_id} | [Edit](${url_action('review_court')})
  **Cause #** | ${case.case_id} | [Edit](${url_action('review_court')})
  **Footer** | ${case.footer} | [Edit](${url_action('review_court')})
  **Divorce?** | ${case.is_divorce} | [Edit](${url_action('review_divorce_flag')})
field: case_details_reviewed
---
event: review_county
decoration: check-double
question: Review County of Venue
review:
  - Edit: case.county
    button: |
      ${case.county}
---
event: review_court
decoration: check-double
question: Review Court and Cause
review:
  - Edit: case.court.court_id
    button: |

      &nbsp; | &nbsp;
      -----|-----
      District Court # | **${case.court.court_id}**<br/>
      Cause # | **${case.case_id}**
      Footer | **${case.footer}**
---
event: review_divorce_flag
decoration: check-double
question: Is this a divorce case?
review:
  - Edit: case.is_divorce
    button: |
      ${case.is_divorce}
---
mandatory: True
code: |
  save_case(case)
---
mandatory: True
decoration: thumbs-up
question: Case Saved.
subquestion: |
  Your case has been saved.
  
  Cause # ${case.case_id} in Judicial District #${case.court.court_id} of ${case.county} County, ${case.state}
  
  **${title_case(case.petitioner.as_noun())}**
  % for p in case.petitioner:
  ${p.name}<br/>
  Represented by:<br/>
  ${p.attorney}<br/>
  % endfor

  **${title_case(case.respondent.as_noun())}**
  % for p in case.respondent:
  ${p.name}<br/>
  Represented by:<br/>
  ${p.attorney}<br/>
  % endfor
  
  % if case.intervenor.number() > 0:
  **${title_case(case.intervenor.as_noun())}**
  % for p in case.intervenor:
  ${p.name}<br/>
  Represented by:<br/>
  ${p.attorney}<br/>
  % endfor
  % endif
  